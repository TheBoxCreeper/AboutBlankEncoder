<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>New Tab</title>
    <link rel="shortcut icon" href="favicons/!Encoder Icon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/zipnotif.css" />
    <link rel="stylesheet" href="css/newtab.css" />
    <link rel="stylesheet" href="font.css" />
    <link rel="stylesheet" href="css/theme.css" />
    <link rel="stylesheet" href="css/base.css" />
  </head>
  <body style="margin: 0px; height: 100vh;">
    <div id="version" class="8"></div>
    <div id="NewTab" style="display: none;height:100vh; background-image: url(NewTabPage/Background.png); background-repeat: no-repeat; background-size: cover; background-attachment: fixed;">
      <iframe style=" z-index: -1;border:none; margin-left: auto; margin-right: 0; width: 100%; height: 64px" src="bar.html"></iframe>
      <img width="272px" height="92px" id="Logo" alt="" src="NewTabPage/GoogleLogo.png">
      <div id="inputWrapper">
        <input placeholder="Search Google or type a URL" id="SearchArea" class="searchBox">
        <script src="NewTabPage/newtab.js"></script>
      </div>
    </div>
    <div id="bodyDiv" class="bodyDiv" style="margin-left: 8px; margin-right:8px z-index:10;">
      <h1 class="title">About:Blank Encoder by <a id="TitleLink" href="https://sites.google.com/view/terminal-games">Terminal</a>
      </h1>
      <font face="Inconsolata">Encode any url into a about:blank page! Note: Some websites do not allow this. You can get any version of this encoder here: <a id = "drive" href="https://drive.google.com/drive/folders/1Fc5m2RE5XyS05-HWORFb7ptZXnn5fAxd">Versions</a>. </font>
      <p id="currentTime" style="font-family: Inconsolata"></p>
      <p id="currentConnection" style="font-family: Inconsolata; color:var(--primary-color)">Determining Online Connection</p>
      <p id="versionCounter" style="font-family: Inconsolata">Version: Determining Version</p>
      <button class="c-button"id="update" disabled >Update</button>
      <br>
      <p class="ZipNotif" style="font-family: Inconsolata; color: #ff0000">This file is still in a Zipped(Compressed) folder! Some functions may be broken as this is not supposed to run in a zipped(Compressed) folder! Extract the folder and then run this file.</p>
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <label for="URLInput" style="font-family: Inconsolata">Put your url below! (Required, Make sure to include http://)</label>
      <br>
      <input class="TextInput" id="URLInput" type="text" placeholder="URL">
      <br>
      <label for="TitleInput" style="font-family: Inconsolata">Put the title of the page below! You should use the appropiate title for the icon (Optional)</label>
      <br>
      <input class="TextInput" id="TitleInput" type="text" placeholder="about:blank">
      <br>
      <label for="upload" style="font-family: Inconsolata" id="ImageLabel">Upload the icon below. Choose an appropiate icon for the title. Icons are available in the favicon folder (Optional)</label>
      <br>
      <br>
      <button type="button" class="c-button c-width" id="UploadButton">Upload Image for Icon (Optional)</button>
      <input type="file" accept="image/*" id="upload" class="FileInput">
      <p id="UploadText">Image Chosen: No Image Chosen</p>
      <img id="DisplayImage" src="#" alt="Image Chosen">
      <br>
      <label for="RuffleBox" class="hiddencheckbox">Use Ruffle scripts for Flash Games. <input type="checkbox" id="RuffleBox">
        <span class="Cbox"></span>
      </label>
      <label for="BCodeBox" class="hiddencheckbox">Encode HTML code in the body instead of an URL. This can be used if you want to use an iframe insted of an embed. <input type="checkbox" id="BCodeBox">
        <span class="Cbox"></span>
      </label>
      <label for="WarnBox" class="hiddencheckbox">Display a warning on when the tab is closed. <input type="checkbox" id="WarnBox">
        <span class="Cbox"></span>
      </label>
      <label for="DynamicBox" class="hiddencheckbox">Use Dynamic Tabs for URLs. <input type="checkbox" id="DynamicBox">
        <span id="DynamicBoxSpan" class="Cbox"></span>
      </label>
      <label for="PopupBox" class="hiddencheckbox">Open tab as popup (New window). <input type="checkbox" id="PopupBox">
        <span class="Cbox"></span>
      </label>
      <br>
      <label for="HeadCode" style="font-family: Inconsolata">Insert Head HTML code here! (Optional)</label>
      <br>
      <textarea class="TextInput" id="HeadCode" type="text" placeholder="Your code here..."></textarea>
      <br>
      <label for="BodyCode" style="font-family: Inconsolata">Insert Body HTML code here! (Optional)</label>
      <br>
      <textarea disabled class="TextInput" id="BodyCode" type="text" placeholder="Your code here..."></textarea>
      <br>
      <button type="button" id="LinkButton" class="c-button c-width">Open link in about:blank!</button>
      <h1 class="title">View embeddable links below:</h1>
      <p id="OfflineBox" style="visibility: hidden; font-family: Inconsolata; color: #ff0000">You cannot embed website urls without internet. Doing so will show an error page.</p>
      <iframe id="UrlRef" width="100%" height="500px" style="border:none" scrolling="no" src="https://docs.google.com/spreadsheets/u/0/d/1sQ9YZpkpZfFlBKKuGHKwyHQ6Iyd38ciy3JAjNVFpQNs/htmlembed/sheet?headers=false&gid=270422712"></iframe>
      <script>
        console.log("About Blank")
        const urlObj = new window.URL(window.location.href);
        const URLInput2 = document.getElementById("URLInput2");
        const URLInput = document.getElementById("URLInput");
        let url = URLInput.value;
        let win;
        let NewTabState;
        const NewTabFrame = document.getElementById('NewTab');
        const BodyDiv = document.getElementById('bodyDiv');
        const HeadHtml = document.getElementById('HeadCode');
        const BodyHtml = document.getElementById('BodyCode');
        const UploadButton = document.getElementById('UploadButton');
        const Upload = document.getElementById('upload');
        const BodySwitch = document.getElementById('BCodeBox');
        const UploadTitle = document.getElementById('TitleInput');
        const UploadText = document.getElementById('UploadText');
        const UploadedIcon = document.getElementById('DisplayImage');
        const OnlineSViewer = document.getElementById('currentConnection');
        const UrlRef = document.getElementById('UrlRef');
        const OfflineBox = document.getElementById('OfflineBox');
        const DynamicBox = document.getElementById('DynamicBox');
	const PopupBox = document.getElementById('PopupBox');
        const DynamicBoxSpan = document.getElementById('DynamicBoxSpan');
        let iconURL;
        const internet = false;

        function checkConnection() {
          if (navigator.onLine) {
            const internet = true
            OnlineSViewer.style.color = "var(--primary-color)"
            OnlineSViewer.textContent = "You are online!"
            UrlRef.style.visibility = 'visible';
            OfflineBox.style.visibility = 'hidden';
          } else {
            const internet = false
            OnlineSViewer.style.color = "#ff0000"
            OnlineSViewer.textContent = "You are offline!"
            OfflineBox.style.visibility = 'visible';
            UrlRef.style.visibility = 'hidden';
          };
          return internet;
        };
        window.addEventListener('load', checkConnection);
        window.addEventListener('online', checkConnection);
        window.addEventListener('offline', checkConnection);
        window.addEventListener('keydown', function(event) {
          if (event.ctrlKey && event.key === '\\') {
            console.log('Keyswitch detected')
            if (NewTabState) {
              NewTabState = false;
              NewTabFrame.style.display = 'none';
              BodyDiv.style.display = 'block';
              console.log('NewTabState1 is ', NewTabState);
            } else {
              NewTabState = true
              NewTabFrame.style.display = 'block';
              BodyDiv.style.display = 'none'
              console.log('NewTabState2 is ', NewTabState);
            };
          };
        });
        Upload.addEventListener('change', function() {
          UploadText.textContent = "Image Chosen: " + this.files[0].name
        })
        UploadButton.onclick = function() {
          document.getElementById('upload').click();
        };
        BodySwitch.addEventListener('change', (event) => {
          EncodeBody();
        });
        function EncodeBody() {
          if (BodySwitch.checked) {
            URLInput.setAttribute("disabled", "true");
            DynamicBox.setAttribute("disabled", "true");
            DynamicBox.checked = false;
            DynamicBoxSpan.className = 'Cbox disabled';
            BodyHtml.removeAttribute("disabled");
          } else {
            URLInput.removeAttribute("disabled");
            DynamicBox.setAttribute("disabled", "true");
            DynamicBoxSpan.className = 'Cbox disabled';
            BodyHtml.setAttribute("disabled", "true");
          }
        };
        Upload.addEventListener('change', (event) => {
          const icon = event.target.files[0];
        });
        function UIF() {
          const [file] = Upload.files;
          if (file) {
            let iconURL = URL.createObjectURL(file);
            UploadedIcon.src = iconURL;
            return iconURL;
          } else {
            let iconURL = undefined;
            return iconURL;
          };
        };
        function showTime() {
          document.getElementById('currentTime').innerHTML = new Date().toUTCString();
        };
        showTime();
        setInterval(function() {
          showTime();
        }, 1000);
        Upload.onchange = evt => {
          UIF();
        };
	function newTab() {
          if (PopupBox.checked) {
	    win = window.open('','_blank','width=600;height=400');  
	  } else {
	    win = window.open();  
	  };
	return win;
        };
        document.querySelector('#LinkButton').onclick = function() {
	  newTab();
          win.document.body.style.margin = '0';
          win.document.body.style.height = '100vh';
          win.document.head.innerHTML = HeadHtml.value;
          const embed = win.document.createElement('iframe');
          embed.style.border = 'none';
          embed.style.width = '100%';
          embed.style.margin = '0';
          embed.id = 'Embed';
          embed.src = document.getElementById("URLInput").value;
          const embed2 = win.document.createElement('embed');
          embed2.style.border = 'none';
          embed2.style.width = '100%';
          embed2.style.height = 'calc(100vh - 42px)';
          embed2.style.margin = '0';
          embed2.id = 'Embed2';
          embed2.src = "https://cache.armorgames.com/files/games/awesome-tanks-12812.swf"
          embed2.style.display = 'none'
          if (DynamicBox.checked) {
            embed.style.height = 'calc(100vh - 42px)';
	    embed2.style.height = 'calc(100vh - 42px)';
          } else {
            embed.style.height = '100vh'
	    embed2.style.height = '100vh'
          };
          const icon = win.document.createElement('link');
          icon.rel = "shortcut icon";
          icon.id = "PageIcon"
          console.log(iconURL);
          icon.href = UIF()
          win.document.head.appendChild(icon);
          const title = win.document.createElement('title');
          title.id = "PageTitle"
          title.textContent = UploadTitle.value
          win.document.head.appendChild(title);
          console.log(document.getElementById('RuffleBox').checked)
          if (document.getElementById('RuffleBox').checked) {
            const Ruffle = win.document.createElement('script');
            Ruffle.src = "https://unpkg.com/@ruffle-rs/ruffle";
            win.document.head.appendChild(Ruffle);
          };
          if (DynamicBox.checked) {
	    const Ruffle2 = win.document.createElement('script');
            Ruffle2.src = "https://unpkg.com/@ruffle-rs/ruffle";
            win.document.head.appendChild(Ruffle2);
            const themecolors = win.document.createElement('link');
            themecolors.rel = "stylesheet";
            themecolors.href = "css/theme.css";
            win.document.body.appendChild(themecolors);
            const terminalstyle = win.document.createElement('link');
            terminalstyle.rel = "stylesheet";
            terminalstyle.href = "css/base.css";
            win.document.body.appendChild(terminalstyle);
            const fontstyle = win.document.createElement('link');
            fontstyle.rel = "stylesheet";
            fontstyle.href = "font.css";
            win.document.body.appendChild(fontstyle);
            const cfscript = win.document.createElement('script');
            cfscript.src = "DynamicTab/dynamictab.js"
            win.document.body.appendChild(cfscript)
            const ctrlFrame = win.document.createElement('div');
            ctrlFrame.id = 'ctrlFrame';
            const ctrlFrameParts = win.document.createElement('div');
            ctrlFrameParts.id = 'ctrlFrameParts';
            ctrlFrameParts.style.height = 'calc(100vh - 105px)';
            ctrlFrameParts.style.display = 'none';
            ctrlFrameParts.style.marginTop = '33px';
            ctrlFrameParts.style.marginRight = '33px';
            ctrlFrameParts.style.marginLeft = '33px';
            const texttitle = win.document.createElement('p');
            texttitle.className = 'title';
            texttitle.innerHTML = 'About:Blank Dynamic Tab by '
            const tturl = win.document.createElement('a');
            tturl.setAttribute("href",document.getElementById("TitleLink").getAttribute("href"));
            tturl.textContent = "Terminal";
            texttitle.appendChild(tturl);
            ctrlFrameParts.appendChild(texttitle);
            const UrlLabel = win.document.createElement('label');
            UrlLabel.setAttribute('for', 'UrlInput');
            UrlLabel.textContent = 'Tab Url';
            UrlLabel.style.fontFamily = "Inconsolata";
            ctrlFrameParts.appendChild(UrlLabel);
            const UrlTabInput = win.document.createElement('input');
            UrlTabInput.setAttribute('type', 'text');
            UrlTabInput.className = 'TextInput';
            UrlTabInput.id = 'UrlInput';
            UrlTabInput.setAttribute('value', document.getElementById("URLInput").value)
            ctrlFrameParts.appendChild(UrlTabInput);
            const TitleLabel = win.document.createElement('label');
            TitleLabel.setAttribute('for', 'TitleInput');
            TitleLabel.textContent = 'Tab Title';
            TitleLabel.style.fontFamily = "Inconsolata";
            ctrlFrameParts.appendChild(TitleLabel);
            const TitleInput = win.document.createElement('input');
            TitleInput.setAttribute('type', 'text');
            TitleInput.className = 'TextInput';
            TitleInput.id = 'TitleInput';
            TitleInput.setAttribute('value', document.getElementById("TitleInput").value);
            ctrlFrameParts.appendChild(TitleInput);
            const ImageLabel = win.document.createElement('label');
            ImageLabel.setAttribute('for', 'upload');
            ImageLabel.style.fontFamily = "Inconsolata";
            ImageLabel.textContent = 'Tab Icon';
            ctrlFrameParts.appendChild(ImageLabel);
            const break1 = win.document.createElement('br');
            ctrlFrameParts.appendChild(break1);
            const break2 = win.document.createElement('br');
            ctrlFrameParts.appendChild(break2);
            const uploadTabButton = win.document.createElement('button');
            uploadTabButton.setAttribute('type', 'button');
            uploadTabButton.id = 'UploadButton';
            uploadTabButton.className = 'c-button c-width';
            uploadTabButton.textContent = 'Upload Image for Icon';
            ctrlFrameParts.appendChild(uploadTabButton);
            const uploadIcon = win.document.createElement('input');
            uploadIcon.setAttribute('type', 'file');
            uploadIcon.id = 'upload';
            uploadIcon.className = 'FileInput';
            uploadIcon.setAttribute('accept', 'image/*');
            ctrlFrameParts.appendChild(uploadIcon);
            const UploadTabText = win.document.createElement('p');
            UploadTabText.id = 'UploadText';
            UploadTabText.textContent = 'Tab Icon: Unchanged';
            ctrlFrameParts.appendChild(UploadTabText);
            const DisplayIcon = win.document.createElement('img');
            DisplayIcon.id = 'DisplayImage';
            DisplayIcon.setAttribute('alt', 'Image Chosen')
            DisplayIcon.src = UIF();
            ctrlFrameParts.appendChild(DisplayIcon);
	    const break3 = win.document.createElement('br');
	    ctrlFrameParts.appendChild(break3);
	    const ruffleLabel = win.document.createElement('label');
	    ruffleLabel.setAttribute('for','RuffleBox');
	    ruffleLabel.className = 'hiddencheckbox';
	    ruffleLabel.textContent = 'Use Ruffle scripts for Flash Games.';
	    const ruffleCheck = win.document.createElement('input');
	    ruffleCheck.setAttribute('type','checkbox');
	    ruffleCheck.id = 'RuffleBox';
	    ruffleLabel.appendChild(ruffleCheck);
	    const ruffleFC = win.document.createElement('span');
	    ruffleFC.className = 'Cbox';
	    ruffleLabel.appendChild(ruffleFC);
	    ctrlFrameParts.appendChild(ruffleLabel);
            //ctrlFrameParts end
            ctrlFrame.appendChild(ctrlFrameParts);
            const arrowbtn = win.document.createElement('button');
            arrowbtn.id = 'arrow'
            arrowbtn.setAttribute('onclick', 'cf();')
            arrowbtn.setAttribute('type', 'submit');
            const arrowsym = win.document.createElement('i');
            arrowsym.id = "arrowsymholder"
            arrowsym.className = "arrowsym down"
            arrowbtn.appendChild(arrowsym);
            ctrlFrame.appendChild(arrowbtn);
            win.document.body.appendChild(ctrlFrame);
          };
          if (document.getElementById('WarnBox').checked) {
            const warn = win.document.createElement('script')
            warn.textContent = 'const beforeUnloadHandler = (event) => {event.preventDefault();event.returnValue = true; }; window.addEventListener(\"beforeunload\", beforeUnloadHandler);'
            win.document.head.appendChild(warn);
          };
          win.document.body.appendChild(embed);
	  win.document.body.appendChild(embed2);
          if (BodySwitch.checked) {
            win.document.body.innerHTML = BodyHtml.value;
          }; //Anything past this point in the script can be inserted in the body safely.
        };
      </script>
      <script src="https://cdn.jsdelivr.net/gh/TheBoxCreeper/AboutBlankEncoder@master/or/update.js"></script>
    </div>
  </body>
</html>
