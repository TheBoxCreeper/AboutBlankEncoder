<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>New Tab</title>
    <link rel="shortcut icon" href="favicons/!Encoder Icon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="config.js" ></script>
    <script id='constructor'>
    console.log(config);
    const urlSchemes = ['https://','file://','http://','data:','chrome-extension://']
    let setScheme;
    const cssString = "body {font-family:".concat(config[4].value,"} :root{ --base-color: ",config[0].value,"; --primary-color: ",config[1].value,"; --secondary-color: ",config[2].value,"; --disabled-color: ",config[3].value,"; }");
    const themeCss = document.createElement('style');
    themeCss.textContent = cssString;
    document.head.appendChild(themeCss);
    const baseCss = document.createElement('link');
    baseCss.setAttribute('rel','stylesheet');
    baseCss.setAttribute('href','css/base.css');
    document.head.appendChild(baseCss);
	if (config[5].value !== 'none') {
	  if (urlSchemes.includes(config[5].value)) {
		setScheme = config[5].value;
		} else {
		setScheme = 'http://';
		};
	};
    </script>
    <link rel="stylesheet" href="css/zipnotif.css" />
    <link rel="stylesheet" href="css/newtab.css" />
    <link rel="stylesheet" href="font.css" />
  </head>
  <body style="margin: 0px; height: 100vh;">
    <div id="version" data-version="10"></div>
    <div id="NewTab" style="display: none;height:100vh; background-image: url(NewTabPage/Background.png); background-repeat: no-repeat; background-size: cover; background-attachment: fixed;">
      <iframe title= 'Bar' style=" z-index: -1;border:none; margin-left: auto; margin-right: 0; width: 100%; height: 64px" src="bar.html"></iframe>
      <img width="272px" height="92px" id="Logo" alt="" src="NewTabPage/GoogleLogo.png">
      <div id="inputWrapper">
        <input placeholder="Search Google or type a URL" id="SearchArea" class="searchBox">
        <script>
	  const searchBox = document.getElementById("SearchArea");
          searchBox.addEventListener('keydown', function(event) {
            if (event.key === 'Enter' && config[8].value) {
              const text = `https://google.com/search?q=${encodeURIComponent(searchBox.value)}`
              window.location.href = text;
            };
          });
	</script>
      </div>
    </div>
    <div id="bodyDiv" class="bodyDiv" style="margin-left: 8px; margin-right:8px; z-index:10;">
      <h1 class="title">About:Blank Encoder by <a id="TitleLink" href="https://google.com">Terminal</a>
      </h1>
      <p >Encode any url into a about:blank page! Note: Some websites do not allow this. You can get any version of this encoder here: <a id = "drive" href="https://google.com">Versions</a>. </p>
      <p id="currentTime" ></p>
      <p id="currentConnection" style=" color:var(--primary-color)">Determining Online Connection</p>
      <p id="versionCounter" >Version: Determining Version</p>
      <button type='button' class="c-button"id="update" disabled >Update</button>
      <br>
      <p class="ZipNotif" style="color: #ff0000">The encoder has been installed improperly! This can be caused by being in a zipped folder, causing limited features, or it could be caused by a broken installation. Download the latest one here: <a id='zipLink' href='https://google.com'>Latest Version</a>.</p>
      <label for="URLInput" >Put your url below! (Required)</label>
      <br>
      <input class="TextInput" id="URLInput" type="text" placeholder="URL">
      <br>
      <label for="TitleInput" >Put the title of the page below! You should use the appropiate title for the icon (Optional)</label>
      <br>
      <input class="TextInput" id="TitleInput" type="text" placeholder="about:blank">
      <br>
      <label for="upload"  id="ImageLabel">Upload the icon below. Choose an appropiate icon for the title. Icons are available in the favicon folder (Optional)</label>
      <br>
      <br>
      <button type="button" class="c-button" style = 'min-width: 100%;' id="UploadButton">Upload Image for Icon (Optional)</button>
      <input type="file" accept="image/*" id="upload" style='display: none;'>
      <p id="UploadText">Image Chosen: No Image Chosen</p>
      <img id="DisplayImage" src="#" alt="Image Chosen">
      <br>
      <label for="RuffleBox" class="hiddencheckbox">Use Ruffle scripts for Flash Games. <input type="checkbox" id="RuffleBox">
        <span class="Cbox"></span>
      </label>
      <label for="BCodeBox" id = 'bodyLabel' style = 'display:none;' class="hiddencheckbox">Encode HTML code in the body instead of an URL. This can be used if you want to use an iframe insted of an embed. <input type="checkbox" id="BCodeBox">
        <span class="Cbox"></span>
      </label>
      <label for="WarnBox" class="hiddencheckbox">Display a warning on when the tab is closed. <input type="checkbox" id="WarnBox">
        <span class="Cbox"></span>
      </label>
      <label for="DynamicBox" class="hiddencheckbox">Use Dynamic Tabs for URLs. <input type="checkbox" id="DynamicBox">
        <span id="DynamicBoxSpan" class="Cbox"></span>
      </label>
      <label for="PopupBox" class="hiddencheckbox">Open tab as popup (New window). <input type="checkbox" id="PopupBox">
        <span class="Cbox"></span>
      </label>
      <br>
      <div id='htmlCode' style='display:none;'>
      <label for="HeadCode" >Insert Head HTML code here! (Optional)</label>
      <br>
      <textarea class="TextInput" id="HeadCode" type="text" placeholder="Your code here..."></textarea>
      <br>
      <label for="BodyCode" >Insert Body HTML code here! (Optional)</label>
      <br>
      <textarea disabled class="TextInput" id="BodyCode" type="text" placeholder="Your code here..."></textarea>
      <br>
      </div>
      <button type="button" id="LinkButton" class="c-button " style = 'min-width: 100%;'>Open link in about:blank!</button>
      <h1 class="title">View embeddable links below:</h1>
      <p id="OfflineBox" style="visibility: hidden; color: #ff0000">You cannot embed website urls without internet. Doing so will show an error page.</p>
      <iframe title='Link list' id="UrlRef" width="100%" height="500px" style="border:none" scrolling="no" src="https://google.com"></iframe>
	<br>
	<h1 class="title">Bookmarklet</h1>
	<p>This is the only way to launch the dynamic tab on other pages than about:blank. This bookmarklet saves your configurations. To use it, click the bookmarklet on the bookmarks bar. What is the bookmark bar? It is the bar with all your bookmarks. What are bookmarks? Bookmarks saved URLs where you can save one by pressing the star. To show the bookmark bar, click the three vertical dots next to your profile, select Bookmarks and lists, and click Show Bookmarks bar. The link below generates the dynamic tab bookmarklet. The link says New Tab, so drag the New Tab link below to the bookmark bar.</p>
	<div style = "align-items: center; justify-content: center; width: 100%; display: flex">
	<a style = "text-align: center;" href = "about:blank" id = 'dTConstructor'>New Tab</a>
	</div>
	<br>
	<br>
      <script>
        const urlObj = new window.URL(window.location.href);
        const URLInput2 = document.getElementById("URLInput2");
        const URLInput = document.getElementById("URLInput");
	const dTC = document.getElementById("dTConstructor");
        let win;
        let NewTabState;
        const NewTabFrame = document.getElementById('NewTab');
        const BodyDiv = document.getElementById('bodyDiv');
        const HeadHtml = document.getElementById('HeadCode');
        const BodyHtml = document.getElementById('BodyCode');
        const UploadButton = document.getElementById('UploadButton');
        const Upload = document.getElementById('upload');
        const BodySwitch = document.getElementById('BCodeBox');
        const UploadTitle = document.getElementById('TitleInput');
        const UploadText = document.getElementById('UploadText');
        const UploadedIcon = document.getElementById('DisplayImage');
        const OnlineSViewer = document.getElementById('currentConnection');
        const UrlRef = document.getElementById('UrlRef');
        const OfflineBox = document.getElementById('OfflineBox');
        const DynamicBox = document.getElementById('DynamicBox');
	const PopupBox = document.getElementById('PopupBox');
        const DynamicBoxSpan = document.getElementById('DynamicBoxSpan');
	const codeCheck1 = "javascript:window.ctrlFrame2 = document.getElementById(\'ctrlFrame\');window.ctrlFrameParts2 = document.getElementById(\'ctrlFrameParts\');if (window.ctrlFrame2 === null) {if (!document.getElementById(\'ctrlTheme\')) {const ctrlTheme = document.createElement(\'style\');ctrlTheme.id = \'ctrlTheme\';ctrlTheme.textContent=\'.ctrlFrame{"
        const tp1 = "--base-color: ".concat(hexToRgb(config[0].value),";--primary-color:",hexToRgb(config[1].value),";--secondary-color:",hexToRgb(config[2].value),";--disabled-color:",hexToRgb(config[3].value),";font-family:",config[4].value)
       	const codeCheck2 = "}\';document.head.appendChild(ctrlTheme);}if (navigator.onLine) {const scrCtrl = document.createElement(\'script\');scrCtrl.id = \'scrCtrl\';scrCtrl.src = \'https://cdn.jsdelivr.net/gh/TheBoxCreeper/AboutBlankEncoder@master/or/generate.js?t=<%= new Date().getTime() %>\';document.head.appendChild(scrCtrl);} else if (!document.getElementById(\'scrCtrl\')) {const scrCtrl = document.createElement(\'script\');scrCtrl.id = \'scrCtrl\';scrCtrl.textContent = \'const ag = document.createElement(\\\'script\\\');ag.textContent = \\\'const ctrlFrame = document.getElementById(\\\\\\\"ctrlFrame\\\\\\\");const ctrlFrameParts = document.getElementById(\\\\\\\"ctrlFrameParts\\\\\\\");const ruffleBox = document.getElementById(\\\\\\\'RuffleBox\\\\\\\');const arrow = document.getElementById(\\\\\\\"arrowsymholder\\\\\\\");const UploadButton = document.getElementById(\\\\\\\'UploadButton\\\\\\\');const Upload = document.getElementById(\\\\\\\'upload\\\\\\\');const UploadText = document.getElementById(\\\\\\\'UploadText\\\\\\\');const UploadedIcon = document.getElementById(\\\\\\\'DisplayImage\\\\\\\');const PageIcon = document.getElementById(\\\\\\\'PageIcon\\\\\\\');const Title = document.getElementById(\\\\\\\'PageTitle\\\\\\\');const TitleInput = document.getElementById(\\\\\\\'TitleInput\\\\\\\');const Embed = document.getElementById(\\\\\\\'Embed\\\\\\\');const UrlInput = document.getElementById(\\\\\\\'UrlInput\\\\\\\');const bodyHtml = document.getElementById(\\\\\\\'bodyHtml\\\\\\\');let cfState = false;let initialState;if (bodyHtml === null) {initialState = true;}let iconURL = UrlInput.value;function cf() {if (cfState === true) { cfState = false;} else {cfState = true;}ctrlFrameParts.style.display = cfState ? \\\\\\\"block\\\\\\\" : \\\\\\\"none\\\\\\\";if(initialState === false) {document.getElementById(\\\\\\\"Embed\\\\\\\").style.display = cfState ? \\\\\\\"none\\\\\\\" : \\\\\\\"block\\\\\\\";document.getElementById(\\\\\\\"Embed2\\\\\\\").style.display = cfState ? \\\\\\\"none\\\\\\\" : (ruffleBox.checked ? \\\\\\\"block\\\\\\\" : \\\\\\\"none\\\\\\\");} else {bodyHtml.style.display=cfState ? \\\\\\\"none\\\\\\\" : \\\\\\\"block\\\\\\\";}arrow.className = cfState ? \\\\\\\"arrowsym up\\\\\\\" : \\\\\\\"arrowsym down\\\\\\\"};Upload.addEventListener(\\\\\\\'change\\\\\\\', (event) =>{const icon = event.target.files[0];UploadText.textContent = \\\\\\\"Tab Icon: \\\\\\\" + icon.name;});UploadButton.onclick = function() {document.getElementById(\\\\\\\'upload\\\\\\\').click();};Upload.onchange = evt => {const[file]= Upload.files;if (file) {iconURL = URL.createObjectURL(file);UploadedIcon.src = iconURL;PageIcon.href = iconURL;return iconURL;};};TitleInput.addEventListener(\\\\\\\'change\\\\\\\',function(event) {Title.textContent = TitleInput.value;});UrlInput.addEventListener(\\\\\\\'change\\\\\\\', function(event) {initialState = false;document.getElementById(\\\\\\\'Embed\\\\\\\').src = UrlInput.value;if (ruffleBox.checked) {document.getElementById(\\\\\\\'Embed2\\\\\\\').src = UrlInput.value;};});ruffleBox.addEventListener(\\\\\\\'change\\\\\\\', function() {initialState = false;document.getElementById(\\\\\\\'Embed\\\\\\\').src = UrlInput.value;document.getElementById(\\\\\\\'Embed2\\\\\\\').src = UrlInput.value;});function deleteFrame() {ctrlFrame.style.display = \\\\\\\'none\\\\\\\';initialState = false;document.getElementById(\\\\\\\'Embed\\\\\\\').style.height = \\\\\\\'100vh\\\\\\\';document.getElementById(\\\\\\\'Embed2\\\\\\\').style.height = \\\\\\\'100vh\\\\\\\';cf();}\\\';const b = document.createElement(\\\'div\\\');b.id = \\\'bodyHtml\\\';b.setAttribute(\\\"style\\\",document.body.getAttribute(\\\"style\\\"));b.style.height = \\\"100vh\\\";const c = document.createDocumentFragment();while (document.body.firstChild) {c.appendChild(document.body.firstChild);}b.appendChild(c);document.body.insertBefore(b,document.body.firstChild);let d = document.querySelector(\\\'title\\\'); if (d === null) {d = document.createElement(\\\'title\\\');document.head.appendChild(d);}d.id=\\\'PageTitle\\\';let a = document.querySelector(\\\'link[rel=\\\"icon\\\"],link[rel=\\\"shortcut icon\\\"]\\\'); if (a === null) {a = document.createElement(\\\'link\\\'); a.setAttribute(\\\'rel\\\',\\\'icon\\\');document.head.appendChild(a);}a.id=\\\'PageIcon\\\';let f = a.getAttribute(\\\'href\\\');if (document.querySelector(\\\'script[src=\\\"https://unpkg.com/@ruffle-rs/ruffle\\\"]\\\') === null) {const rs = document.createElement(\\\'script\\\'); rs.src = \\\'https://unpkg.com/@ruffle-rs/ruffle\\\'; document.head.appendChild(rs);} let g = d.textContent;const j = document.createElement(\\\'link\\\');j.setAttribute(\\\'rel\\\',\\\'preconnect\\\');j.setAttribute(\\\'href\\\',\\\'https://fonts.googleapis.com\\\');document.head.appendChild(j);const k = document.createElement(\\\'link\\\');k.setAttribute(\\\'rel\\\',\\\'preconnect\\\');k.setAttribute(\\\'href\\\',\\\'https://fonts.gstatic.com\\\');k.setAttribute(\\\'crossorigin\\\',\\\'\\\');document.head.appendChild(k);const l = document.createElement(\\\'style\\\');l.textContent=\\\'.ctrlFrame{background-color: var(--base-color);color: var(--primary-color);}.TextInput {width: 100%;padding: 12px 3px;margin: 8px 0;box-sizing: border-box;border: 2px solid var(--primary-color);border-radius: 4px;background-color: var(--base-color);color: var(--primary-color);font-family: inherit;}.TextInput:focus {outline: none;border: 3px solid var(--primary-color);padding: 11px 3px;}.TextInput::placeholder {opacity: 0.5;color: var(--primary-color);font-family: inherit;}.TextInput:disabled {border: 2px solid var(--secondary-color);background-color: var(--disabled-color);cursor: not-allowed;}.c-button {appearance: none;border: 0;border-radius: 5px;background: var(--primary-color);color: var(--base-color);padding: 12px 46px;font-size: 16px;cursor: pointer;display: flex;align-items: center;justify-content: center;height: 38px;font-family: inherit;}.c-button:hover {background: var(--secondary-color);}.c-button:focus {outline: none;box-shadow: 0 0 0 4px var(--secondary-color);}.hiddencheckbox {display: block;position: relative;padding-left: 35px;margin-bottom: 12px;cursor: pointer;font-size: 16px;}.Cbox {position: absolute;top: 0;left: 0;height: 18px;width: 18px;background-color: var(--base-color);border: 2px solid var(--primary-color);border-radius: 5px;}.Cbox:after {content: \\\"\\\";position: absolute;display: none;}.hiddencheckbox input:checked~.Cbox:after {display: block;}.hiddencheckbox .Cbox:after {left: 5px;top: 1px;width: 5px;height: 10px;border: solid var(--primary-color);border-width: 0 3px 3px 0;transform: rotate(45deg);}.UploadText {text-align: center;width: 100%;}.DisplayImage {margin-left: auto;margin-right: auto;display: block;}.a:link {color: var(--primary-color);}.a:hover {color: var(--secondary-color);}.a:active {color: var(--primary-color);}.a:visited {color: var(--primary-color);}.a:focus {outline: 2px solid var(--primary-color);outline-offset: 2px;}.arrow {display:flex;background: var(--primary-color);width:100%;outline: none;cursor: pointer;height: 38px;text-align: center;align-items: center;justify-content: center;}.arrowsym {border: solid var(--base-color);border-width: 0 4px 4px 0;display: inline-block;padding: 8px;}.up {transform: rotate(-135deg);}.down {transform: rotate(45deg);}.blksqr {height:50px;width:50px;border: solid 3px var(--primary-color);border-radius: 10px;font-size:25px;background-color: var(--base-color);color:var(--primary-color);cursor: pointer;}\\\';document.head.appendChild(l);const n = document.createElement(\\\'link\\\'); n.rel=\\\'stylesheet\\\';n.setAttribute(\\\'href\\\',\\\'https%3A%2F%2Ffonts.googleapis.com%2Fcss2%3Ffamily%3DInconsolata%3Awght%40200..900%26family%3DPress%2BStart%2B2P%26family%3DRoboto%3Aital%2Cwght%400%2C100..900%3B1%2C100..900%26display%3Dswap\\\');document.head.appendChild(n);const o = document.createElement(\\\'div\\\');o.id=\\\'ctrlFrame\\\';o.className=\\\'ctrlFrame\\\';const p = document.createElement(\\\'div\\\');p.id=\\\'ctrlFrameParts\\\';p.style.height = \\\'100vh\\\';p.style.marginLeft = \\\'33px\\\';p.style.marginRight = \\\'33px\\\';p.style.display = \\\'none\\\';const bq = document.createElement(\\\'br\\\');p.appendChild(bq);const rq = document.createElement(\\\'p\\\');rq.className = \\\'title\\\';rq.textContent =  \\\'About:Blank Dynamic Tab by \\\';const qr = document.createElement(\\\'a\\\');qr.textContent = \\\'Terminal\\\';qr.className = \\\'a\\\';qr.setAttribute(\\\'href\\\',\\\'https%3A%2F%2Fsites.google.com%2Fview%2Fterminal-games\\\');rq.appendChild(qr);p.appendChild(rq);const s1 = document.createElement(\\\'label\\\');s1.textContent = \\\'Tab Url\\\';s1.setAttribute(\\\'for\\\',\\\'UrlInput\\\');p.appendChild(s1);const t1 = document.createElement(\\\'input\\\');t1.id=\\\'UrlInput\\\';t1.className = \\\'TextInput\\\';t1.setAttribute(\\\'type\\\',\\\'text\\\');t1.setAttribute(\\\'value\\\',window.location.href);p.appendChild(t1);const s2 = document.createElement(\\\'label\\\');s2.textContent = \\\'Tab Title\\\';;s2.setAttribute(\\\'for\\\',\\\'TitleInput\\\');p.appendChild(s2);const t2 = document.createElement(\\\'input\\\');t2.setAttribute(\\\'type\\\',\\\'text\\\');t2.setAttribute(\\\'value\\\',d.textContent);t2.id=\\\'TitleInput\\\';t2.className = \\\'TextInput\\\';p.appendChild(t2);const s3 = document.createElement(\\\'label\\\');s3.textContent = \\\'Tab Icon\\\';s3.setAttribute(\\\'for\\\',\\\'upload\\\');p.appendChild(s3);const u = document.createElement(\\\'br\\\');p.appendChild(u);const v = document.createElement(\\\'br\\\');p.appendChild(v);const w = document.createElement(\\\'button\\\');w.textContent = \\\'Upload Image for Icon\\\';w.className = \\\'c-button\\\';w.id = \\\'UploadButton\\\';w.style.minWidth = \\\'100%\\\';w.setAttribute(\\\'type\\\',\\\'button\\\');p.appendChild(w);const x = document.createElement(\\\'input\\\');x.setAttribute(\\\'type\\\',\\\'file\\\');x.id=\\\'upload\\\';x.style.display = \\\'none\\\';x.setAttribute(\\\'accept\\\',\\\'image/*\\\');p.appendChild(x);const y = document.createElement(\\\'p\\\');y.id = \\\'UploadText\\\';y.className = \\\'UploadText\\\';y.textContent = \\\'Tab Icon:\\\';p.appendChild(y);const z = document.createElement(\\\'img\\\');z.id = \\\'DisplayImage\\\';z.className = \\\'DisplayImage\\\';z.setAttribute(\\\'src\\\',f);z.setAttribute(\\\'alt\\\',\\\'Image Chosen\\\');p.appendChild(z);const aa = document.createElement(\\\'br\\\');p.appendChild(aa);const ab = document.createElement(\\\'label\\\');ab.className = \\\'hiddencheckbox\\\';ab.setAttribute(\\\'for\\\',\\\'RuffleBox\\\');ab.textContent = \\\'Use Ruffle scripts for Flash Games.\\\';const ac = document.createElement(\\\'input\\\');ac.setAttribute(\\\'type\\\',\\\'checkbox\\\');ac.id=\\\'RuffleBox\\\';ac.style.opacity = \\\'0\\\';ab.appendChild(ac);const ad = document.createElement(\\\'span\\\');ad.className = \\\'Cbox\\\';ab.appendChild(ad);p.appendChild(ab);const ae = document.createElement(\\\'div\\\');ae.style.display = \\\'flex\\\';ae.style.justifyContent = \\\'center\\\';const af = document.createElement(\\\'button\\\');af.className=\\\'c-button\\\';af.setAttribute(\\\'onclick\\\',\\\'deleteFrame()\\\');af.textContent = \\\'Disable Dynamic Tabs\\\';af.style.backgroundColor = \\\'rgb(255,0,0)\\\';af.style.color = \\\'rgb(0,0,0)\\\';ae.appendChild(af);p.appendChild(ae);const au = document.createElement(\\\'br\\\');p.appendChild(au);o.appendChild(p); const ar = document.createElement(\\\'button\\\');ar.className=\\\'arrow\\\';ar.setAttribute(\\\'type\\\',\\\'button\\\');ar.setAttribute(\\\'onclick\\\',\\\'cf()\\\');const aro = document.createElement(\\\'i\\\');aro.id = \\\'arrowsymholder\\\';aro.className =\\\'arrowsym down\\\';ar.appendChild(aro);o.appendChild(ar);document.body.insertBefore(o,b);document.body.style.margin = \\\'0px\\\';const e1 = document.createElement(\\\'iframe\\\');e1.style.display = \\\'none\\\';e1.id = \\\'Embed\\\';e1.style.margin = \\\"0px\\\";e1.style.border = \\\'none\\\';e1.style.width = \\\'100%\\\';e1.style.height = \\\'calc(-42px + 100vh)\\\';e1.setAttribute(\\\'src\\\',window.location.href);document.body.appendChild(e1);const e2 = document.createElement(\\\'embed\\\');e2.style.margin = \\\'0px\\\';e2.id=\\\'Embed2\\\';e2.style.display = \\\'none\\\';e2.style.width=\\\'100%\\\';e2.style.height = \\\'calc(-42px + 100vh)\\\';e2.setAttribute(\\\'src\\\',\\\'https%3A%2F%2Fcache.armorgames.com%2Ffiles%2Fgames%2Fawesome-tanks-12812.swf\\\');document.body.appendChild(e2);document.body.insertBefore(ag,document.body.firstChild);\';document.head.appendChild(scrCtrl);}} else {window.ctrlFrame2.style.display = \'block\';}void 0";
	let iconURL;
        function checkConnection() {
          if (navigator.onLine) {
            OnlineSViewer.style.color = "var(--primary-color)";
            OnlineSViewer.textContent = "You are online!";
            UrlRef.style.visibility = 'visible';
            OfflineBox.style.visibility = 'hidden';
          } else {
            OnlineSViewer.style.color = "#ff0000";
            OnlineSViewer.textContent = "You are offline!";
            OfflineBox.style.visibility = 'visible';
            UrlRef.style.visibility = 'hidden';
          };
        };
        window.addEventListener('load', checkConnection);
        window.addEventListener('online', checkConnection);
        window.addEventListener('offline', checkConnection);
	dTC.setAttribute('href',codeCheck1 + tp1 + codeCheck2);
        window.addEventListener('keydown', function(event) {
          if (event.ctrlKey && event.key === '\\') {
            console.log('Keyswitch detected')
            if (NewTabState) {
              NewTabState = false;
              NewTabFrame.style.display = 'none';
              BodyDiv.style.display = 'block';
              console.log('NewTabState1 is ', NewTabState);
            } else {
              NewTabState = true
              NewTabFrame.style.display = 'block';
              BodyDiv.style.display = 'none';
              console.log('NewTabState2 is ', NewTabState);
            };
          };
        });
	function hexToRgb(hex) {
	const cleanHex = hex.startsWith('#') ? hex.slice(1) : hex;
	if (cleanHex.length === 6) {
  	  const r = parseInt(cleanHex.substring(0, 2), 16);
 	   const g = parseInt(cleanHex.substring(2, 4), 16);
 	   const b = parseInt(cleanHex.substring(4, 6), 16);
 	   return `rgb(${r}, ${g}, ${b})`;
	  }
  	return null; 
	}
        Upload.addEventListener('change', function() {
          UploadText.textContent = "Image Chosen: " + this.files[0].name
        })
        UploadButton.onclick = function() {
          document.getElementById('upload').click();
        };
        BodySwitch.addEventListener('change', (event) => {
          EncodeBody();
        });
        function EncodeBody() {
          if (BodySwitch.checked) {
            URLInput.setAttribute("disabled", "true");
            DynamicBox.setAttribute("disabled", "true");
            DynamicBox.checked = false;
            DynamicBoxSpan.className = 'Cbox disabled';
            BodyHtml.removeAttribute("disabled");
          } else {
            URLInput.removeAttribute("disabled");
            DynamicBox.setAttribute("disabled", "true");
            DynamicBoxSpan.className = 'Cbox disabled';
            BodyHtml.setAttribute("disabled", "true");
          };

        };
        Upload.addEventListener('change', (event) => {
          const icon = event.target.files[0];
        });
        function showTime() {
          document.getElementById('currentTime').innerHTML = new Date().toUTCString();
        };
        showTime();
        setInterval(function() {
          showTime();
        }, 1000);
        Upload.onchange = evt => {
           const [file] = Upload.files;
          if (file) {
            iconURL = URL.createObjectURL(file);
            UploadedIcon.src = iconURL;
            return iconURL;
          };

        };
        document.querySelector('#LinkButton').onclick = function() {
	function checkString(str, substrs) {
  		return substrs.some(substr => str.startsWith(substr));
	};
	let url = URLInput.value;
	if (!checkString(url,urlSchemes) &&  !(config[5].value === 'none')) {
	url = setScheme.concat(url);
	};
	  if (PopupBox.checked) {
	    win = window.open('','_blank','width=600;height=400');  
	  } else {
	    win = window.open();  
	  };
          win.document.body.style.margin = '0';
          win.document.body.style.height = '100vh';
          win.document.head.innerHTML = HeadHtml.value;
	  const charset = win.document.createElement('meta');
	  charset.setAttribute('charset','UTF-8');
	  win.document.head.appendChild(charset);
	  let embed;
          const embed2 = win.document.createElement('embed');
	  if (DynamicBox.checked) {
	    embed = win.document.createElement('iframe');
            embed.style.height = 'calc(100vh - 42px)';
	    embed2.style.height = 'calc(100vh - 42px)';
          } else {
	    embed = win.document.createElement('embed');
            embed.style.height = '100vh';
	    embed2.style.height = '100vh';
          };
          embed.style.border = 'none';
          embed.style.width = '100%';
          embed.style.margin = '0';
          embed.id = 'Embed';
          embed.src = url;
          embed2.style.border = 'none';
          embed2.style.width = '100%';
          embed2.style.margin = '0';
          embed2.id = 'Embed2';
          embed2.src = "https://cache.armorgames.com/files/games/awesome-tanks-12812.swf"
          embed2.style.display = 'none'
          const icon = win.document.createElement('link');
          icon.rel = "shortcut icon";
          icon.id = "PageIcon";
          icon.href = iconURL;
          win.document.head.appendChild(icon);
          const title = win.document.createElement('title');
          title.id = "PageTitle"
          title.textContent = UploadTitle.value;
          win.document.head.appendChild(title);
          if (document.getElementById('RuffleBox').checked) {
            const Ruffle = win.document.createElement('script');
            Ruffle.src = "https://unpkg.com/@ruffle-rs/ruffle";
            win.document.head.appendChild(Ruffle);
          };
          if (DynamicBox.checked) {
	    const Ruffle2 = win.document.createElement('script');
            Ruffle2.src = "https://unpkg.com/@ruffle-rs/ruffle";
            win.document.head.appendChild(Ruffle2);
            const themeCss = win.document.createElement('style');
            themeCss.rel = "stylesheet";
            themeCss.textContent = cssString;
            win.document.head.appendChild(themeCss);
            const terminalstyle = win.document.createElement('link');
            terminalstyle.rel = "stylesheet";
            terminalstyle.href = "css/base.css";
            win.document.head.appendChild(terminalstyle);
            const fontstyle = win.document.createElement('link');
            fontstyle.rel = "stylesheet";
            fontstyle.href = "font.css";
            win.document.head.appendChild(fontstyle);
            const cfscript = win.document.createElement('script');
            cfscript.src = "DynamicTab/dynamictab.js"
            win.document.body.appendChild(cfscript)
            const ctrlFrame = win.document.createElement('div');
            ctrlFrame.id = 'ctrlFrame';
	    ctrlFrame.className = 'ctrlFrame';
            const ctrlFrameParts = win.document.createElement('div');
            ctrlFrameParts.id = 'ctrlFrameParts';
            ctrlFrameParts.style.height = 'calc(100vh - 105px)';
            ctrlFrameParts.style.display = 'none';
            ctrlFrameParts.style.marginTop = '33px';
            ctrlFrameParts.style.marginRight = '33px';
            ctrlFrameParts.style.marginLeft = '33px';
            const texttitle = win.document.createElement('p');
            texttitle.className = 'title';
            texttitle.innerHTML = 'About:Blank Dynamic Tab by '
            const tturl = win.document.createElement('a');
            tturl.setAttribute("href",document.getElementById("TitleLink").getAttribute("href"));
            tturl.textContent = "Terminal";
            texttitle.appendChild(tturl);
            ctrlFrameParts.appendChild(texttitle);
            const UrlLabel = win.document.createElement('label');
            UrlLabel.setAttribute('for', 'UrlInput');
            UrlLabel.textContent = 'Tab Url';
            ctrlFrameParts.appendChild(UrlLabel);
            const UrlTabInput = win.document.createElement('input');
            UrlTabInput.setAttribute('type', 'text');
            UrlTabInput.className = 'TextInput';
            UrlTabInput.id = 'UrlInput';
            UrlTabInput.setAttribute('value', url);
            ctrlFrameParts.appendChild(UrlTabInput);
            const TitleLabel = win.document.createElement('label');
            TitleLabel.setAttribute('for', 'TitleInput');
            TitleLabel.textContent = 'Tab Title';
            ctrlFrameParts.appendChild(TitleLabel);
            const TitleInput = win.document.createElement('input');
            TitleInput.setAttribute('type', 'text');
            TitleInput.className = 'TextInput';
            TitleInput.id = 'TitleInput';
            TitleInput.setAttribute('value', document.getElementById("TitleInput").value);
            ctrlFrameParts.appendChild(TitleInput);
            const ImageLabel = win.document.createElement('label');
            ImageLabel.setAttribute('for', 'upload');
            ImageLabel.textContent = 'Tab Icon';
            ctrlFrameParts.appendChild(ImageLabel);
            const break1 = win.document.createElement('br');
            ctrlFrameParts.appendChild(break1);
            const break2 = win.document.createElement('br');
            ctrlFrameParts.appendChild(break2);
            const uploadTabButton = win.document.createElement('button');
            uploadTabButton.setAttribute('type', 'button');
            uploadTabButton.id = 'UploadButton';
            uploadTabButton.className = 'c-button';
	    uploadTabButton.style.minWidth = '100%';
	    uploadTabButton.textContent = 'Upload Image for Icon';
            ctrlFrameParts.appendChild(uploadTabButton);
            const uploadIcon = win.document.createElement('input');
            uploadIcon.setAttribute('type', 'file');
            uploadIcon.id = 'upload';
            uploadIcon.style.display = 'none';
            uploadIcon.setAttribute('accept', 'image/*');
            ctrlFrameParts.appendChild(uploadIcon);
            const UploadTabText = win.document.createElement('p');
            UploadTabText.id = 'UploadText';
	    UploadTabText.className = 'UploadText';
            UploadTabText.textContent = 'Tab Icon: Unchanged';
            ctrlFrameParts.appendChild(UploadTabText);
            const DisplayIcon = win.document.createElement('img');
            DisplayIcon.id = 'DisplayImage';
	    DisplayIcon.className = 'DisplayImage';
            DisplayIcon.setAttribute('alt', 'Image Chosen')
            DisplayIcon.src = iconURL;
            ctrlFrameParts.appendChild(DisplayIcon);
	    const break3 = win.document.createElement('br');
	    ctrlFrameParts.appendChild(break3);
	    const ruffleLabel = win.document.createElement('label');
	    ruffleLabel.setAttribute('for','RuffleBox');
	    ruffleLabel.className = 'hiddencheckbox';
	    ruffleLabel.textContent = 'Use Ruffle scripts for Flash Games.';
	    const ruffleCheck = win.document.createElement('input');
	    ruffleCheck.setAttribute('type','checkbox');
	    ruffleCheck.id = 'RuffleBox';
	    ruffleCheck.style.opacity = '0';
	    ruffleLabel.appendChild(ruffleCheck);
	    const ruffleFC = win.document.createElement('span');
	    ruffleFC.className = 'Cbox';
	    ruffleLabel.appendChild(ruffleFC);
	    ctrlFrameParts.appendChild(ruffleLabel);
	    const deleteBox = win.document.createElement('div');
	    deleteBox.style.display = 'flex';
	    deleteBox.style.justifyContent = 'center';
	    const deleteButton = win.document.createElement('button');
            deleteButton.className = 'c-button';
	    deleteButton.setAttribute('onclick','deleteFrame();');
	    deleteButton.textContent = 'Disable Dynamic Tabs';
	    deleteButton.style.backgroundColor = '#FF0000';
	    deleteButton.style.color =  '#000000';
            deleteBox.appendChild(deleteButton)
	    ctrlFrameParts.appendChild(deleteBox);
            //ctrlFrameParts end
            ctrlFrame.appendChild(ctrlFrameParts);
            const arrowbtn = win.document.createElement('button');
            arrowbtn.className = 'arrow';
            arrowbtn.setAttribute('onclick', 'cf();');
            arrowbtn.setAttribute('type', 'button');
            const arrowsym = win.document.createElement('i');
            arrowsym.id = "arrowsymholder"
            arrowsym.className = "arrowsym down"
            arrowbtn.appendChild(arrowsym);
            ctrlFrame.appendChild(arrowbtn);
            win.document.body.appendChild(ctrlFrame);
          };
          if (document.getElementById('WarnBox').checked) {
            const warn = win.document.createElement('script')
            warn.textContent = 'const beforeUnloadHandler = (event) => {event.preventDefault();event.returnValue = true; }; window.addEventListener(\"beforeunload\", beforeUnloadHandler);'
            win.document.head.appendChild(warn);
          };
          win.document.body.appendChild(embed);
	  win.document.body.appendChild(embed2);
          if (BodySwitch.checked) {
            win.document.body.innerHTML = BodyHtml.value;
          }; //Anything past this point in the script can be inserted in the body safely.
        };
      </script>
      <script id='secondary-constructor'>
	if (config[6].value) {
	UploadedIcon.src = config[6].value;
	iconURL = config[6].value;
	};
	UploadTitle.value = config[7].value;
	if (config[9].value) {
	document.getElementById('htmlCode').style.display = 'block';
	document.getElementById('bodyLabel').style.display = 'block';
	};
	</script>
      <script src="https://cdn.jsdelivr.net/gh/TheBoxCreeper/AboutBlankEncoder@master/or/update.js?t=<%= new Date().getTime() %>"></script>
    </div>
  </body>
</html>
